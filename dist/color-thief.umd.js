!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t||self).ColorThief=n()}(this,function(){if(!t)var t={map:function(t,n){var e={};return n?t.map(function(t,r){return e.index=r,n.call(e,t)}):t.slice()},naturalOrder:function(t,n){return t<n?-1:t>n?1:0},sum:function(t,n){var e={};return t.reduce(n?function(t,r,o){return e.index=o,t+n.call(e,r)}:function(t,n){return t+n},0)},max:function(n,e){return Math.max.apply(null,e?t.map(n,e):n)}};var n=function(){function n(t,n,e){return(t<<10)+(n<<5)+e}function e(t){var n=[],e=!1;function r(){n.sort(t),e=!0}return{push:function(t){n.push(t),e=!1},peek:function(t){return e||r(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return e||r(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return e||r(),n}}}function r(t,n,e,r,o,i,a){var u=this;u.r1=t,u.r2=n,u.g1=e,u.g2=r,u.b1=o,u.b2=i,u.histo=a}function o(){this.vboxes=new e(function(n,e){return t.naturalOrder(n.vbox.count()*n.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function i(e,r){if(r.count()){var o=r.r2-r.r1+1,i=r.g2-r.g1+1,a=t.max([o,i,r.b2-r.b1+1]);if(1==r.count())return[r.copy()];var u,c,s,f,h=0,v=[],l=[];if(a==o)for(u=r.r1;u<=r.r2;u++){for(f=0,c=r.g1;c<=r.g2;c++)for(s=r.b1;s<=r.b2;s++)f+=e[n(u,c,s)]||0;v[u]=h+=f}else if(a==i)for(u=r.g1;u<=r.g2;u++){for(f=0,c=r.r1;c<=r.r2;c++)for(s=r.b1;s<=r.b2;s++)f+=e[n(c,u,s)]||0;v[u]=h+=f}else for(u=r.b1;u<=r.b2;u++){for(f=0,c=r.r1;c<=r.r2;c++)for(s=r.g1;s<=r.g2;s++)f+=e[n(c,s,u)]||0;v[u]=h+=f}return v.forEach(function(t,n){l[n]=h-t}),function(t){var n,e,o,i,a,c=t+"1",s=t+"2",f=0;for(u=r[c];u<=r[s];u++)if(v[u]>h/2){for(o=r.copy(),i=r.copy(),a=(n=u-r[c])<=(e=r[s]-u)?Math.min(r[s]-1,~~(u+e/2)):Math.max(r[c],~~(u-1-n/2));!v[a];)a++;for(f=l[a];!f&&v[a-1];)f=l[--a];return o[s]=a,i[c]=o[s]+1,[o,i]}}(a==o?"r":a==i?"g":"b")}}return r.prototype={volume:function(t){var n=this;return n._volume&&!t||(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(t){var e=this,r=e.histo;if(!e._count_set||t){var o,i,a,u=0;for(o=e.r1;o<=e.r2;o++)for(i=e.g1;i<=e.g2;i++)for(a=e.b1;a<=e.b2;a++)u+=r[n(o,i,a)]||0;e._count=u,e._count_set=!0}return e._count},copy:function(){var t=this;return new r(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var e=this,r=e.histo;if(!e._avg||t){var o,i,a,u,c=0,s=0,f=0,h=0;for(i=e.r1;i<=e.r2;i++)for(a=e.g1;a<=e.g2;a++)for(u=e.b1;u<=e.b2;u++)c+=o=r[n(i,a,u)]||0,s+=o*(i+.5)*8,f+=o*(a+.5)*8,h+=o*(u+.5)*8;e._avg=c?[~~(s/c),~~(f/c),~~(h/c)]:[~~(8*(e.r1+e.r2+1)/2),~~(8*(e.g1+e.g2+1)/2),~~(8*(e.b1+e.b2+1)/2)]}return e._avg},contains:function(t){var n=this,e=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,e>=n.r1&&e<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},o.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,e=0;e<n.size();e++)if(n.peek(e).vbox.contains(t))return n.peek(e).color;return this.nearest(t)},nearest:function(t){for(var n,e,r,o=this.vboxes,i=0;i<o.size();i++)((e=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)))<n||void 0===n)&&(n=e,r=o.peek(i).color);return r},forcebw:function(){var n=this.vboxes;n.sort(function(n,e){return t.naturalOrder(t.sum(n.color),t.sum(e.color))});var e=n[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(n[0].color=[0,0,0]);var r=n.length-1,o=n[r].color;o[0]>251&&o[1]>251&&o[2]>251&&(n[r].color=[255,255,255])}},{quantize:function(a,u){if(!a.length||u<2||u>256)return!1;var c=function(t){var e,r=new Array(32768);return t.forEach(function(t){e=n(t[0]>>3,t[1]>>3,t[2]>>3),r[e]=(r[e]||0)+1}),r}(a);c.forEach(function(){});var s=function(t,n){var e,o,i,a=1e6,u=0,c=1e6,s=0,f=1e6,h=0;return t.forEach(function(t){(e=t[0]>>3)<a?a=e:e>u&&(u=e),(o=t[1]>>3)<c?c=o:o>s&&(s=o),(i=t[2]>>3)<f?f=i:i>h&&(h=i)}),new r(a,u,c,s,f,h,n)}(a,c),f=new e(function(n,e){return t.naturalOrder(n.count(),e.count())});function h(t,n){for(var e,r=t.size(),o=0;o<1e3;){if(r>=n)return;if(o++>1e3)return;if((e=t.pop()).count()){var a=i(c,e),u=a[0],s=a[1];if(!u)return;t.push(u),s&&(t.push(s),r++)}else t.push(e),o++}}f.push(s),h(f,.75*u);for(var v=new e(function(n,e){return t.naturalOrder(n.count()*n.volume(),e.count()*e.volume())});f.size();)v.push(f.pop());h(v,u);for(var l=new o;v.size();)l.push(v.pop());return l}}}().quantize,e=function(t){"CANVAS"===t.nodeName?(this.canvas=t,this.context=t.getContext("2d"),this.width=t.width,this.height=t.height):"VIDEO"===t.nodeName?(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=video.videoWidth,this.height=this.canvas.height=t.videoHeight,this.context.drawImage(t,0,0,this.width,this.height)):(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height))};e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var r=function(){};return r.prototype.getColor=function(t,n){return void 0===n&&(n=10),this.getPalette(t,5,n)[0]},r.prototype.getPalette=function(t,r,o){var i=function(t){var n=t.colorCount,e=t.quality;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return(void 0===e||!Number.isInteger(e)||e<1)&&(e=10),{colorCount:n,quality:e}}({colorCount:r,quality:o}),a=new e(t),u=function(t,n,e){for(var r,o,i,a,u,c=t,s=[],f=0;f<n;f+=e)o=c[0+(r=4*f)],i=c[r+1],a=c[r+2],(void 0===(u=c[r+3])||u>=125)&&(o>250&&i>250&&a>250||s.push([o,i,a]));return s}(a.getImageData().data,a.width*a.height,i.quality),c=n(u,i.colorCount);return c?c.palette():null},r.prototype.getColorFromUrl=function(t,n,e){var r=this,o=document.createElement("img");o.addEventListener("load",function(){var i=r.getPalette(o,5,e);n(i[0],t)}),o.src=t},r.prototype.getImageData=function(t,n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var e=new Array(i),r=0;r<t.length;r++)e[r]=String.fromCharCode(t[r]);var o=e.join(""),a=window.btoa(o);n("data:image/png;base64,"+a)}},e.send()},r.prototype.getColorAsync=function(t,n,e){var r=this;this.getImageData(t,function(t){var o=document.createElement("img");o.addEventListener("load",function(){var t=r.getPalette(o,5,e);n(t[0],this)}),o.src=t})},r});
