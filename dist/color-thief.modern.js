if(!t)var t={map:function(t,n){var e={};return n?t.map(function(t,r){return e.index=r,n.call(e,t)}):t.slice()},naturalOrder:function(t,n){return t<n?-1:t>n?1:0},sum:function(t,n){var e={};return t.reduce(n?function(t,r,o){return e.index=o,t+n.call(e,r)}:function(t,n){return t+n},0)},max:function(n,e){return Math.max.apply(null,e?t.map(n,e):n)}};var n=function(){function n(t,n,e){return(t<<10)+(n<<5)+e}function e(t){var n=[],e=!1;function r(){n.sort(t),e=!0}return{push:function(t){n.push(t),e=!1},peek:function(t){return e||r(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return e||r(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return e||r(),n}}}function r(t,n,e,r,o,i,u){var a=this;a.r1=t,a.r2=n,a.g1=e,a.g2=r,a.b1=o,a.b2=i,a.histo=u}function o(){this.vboxes=new e(function(n,e){return t.naturalOrder(n.vbox.count()*n.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function i(e,r){if(r.count()){var o=r.r2-r.r1+1,i=r.g2-r.g1+1,u=t.max([o,i,r.b2-r.b1+1]);if(1==r.count())return[r.copy()];var a,c,s,h,f=0,l=[],v=[];if(u==o)for(a=r.r1;a<=r.r2;a++){for(h=0,c=r.g1;c<=r.g2;c++)for(s=r.b1;s<=r.b2;s++)h+=e[n(a,c,s)]||0;l[a]=f+=h}else if(u==i)for(a=r.g1;a<=r.g2;a++){for(h=0,c=r.r1;c<=r.r2;c++)for(s=r.b1;s<=r.b2;s++)h+=e[n(c,a,s)]||0;l[a]=f+=h}else for(a=r.b1;a<=r.b2;a++){for(h=0,c=r.r1;c<=r.r2;c++)for(s=r.g1;s<=r.g2;s++)h+=e[n(c,s,a)]||0;l[a]=f+=h}return l.forEach(function(t,n){v[n]=f-t}),function(t){var n,e,o,i,u,c=t+"1",s=t+"2",h=0;for(a=r[c];a<=r[s];a++)if(l[a]>f/2){for(o=r.copy(),i=r.copy(),u=(n=a-r[c])<=(e=r[s]-a)?Math.min(r[s]-1,~~(a+e/2)):Math.max(r[c],~~(a-1-n/2));!l[u];)u++;for(h=v[u];!h&&l[u-1];)h=v[--u];return o[s]=u,i[c]=o[s]+1,[o,i]}}(u==o?"r":u==i?"g":"b")}}return r.prototype={volume:function(t){var n=this;return n._volume&&!t||(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(t){var e=this,r=e.histo;if(!e._count_set||t){var o,i,u,a=0;for(o=e.r1;o<=e.r2;o++)for(i=e.g1;i<=e.g2;i++)for(u=e.b1;u<=e.b2;u++)a+=r[n(o,i,u)]||0;e._count=a,e._count_set=!0}return e._count},copy:function(){var t=this;return new r(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var e=this,r=e.histo;if(!e._avg||t){var o,i,u,a,c=0,s=0,h=0,f=0;for(i=e.r1;i<=e.r2;i++)for(u=e.g1;u<=e.g2;u++)for(a=e.b1;a<=e.b2;a++)c+=o=r[n(i,u,a)]||0,s+=o*(i+.5)*8,h+=o*(u+.5)*8,f+=o*(a+.5)*8;e._avg=c?[~~(s/c),~~(h/c),~~(f/c)]:[~~(8*(e.r1+e.r2+1)/2),~~(8*(e.g1+e.g2+1)/2),~~(8*(e.b1+e.b2+1)/2)]}return e._avg},contains:function(t){var n=this,e=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,e>=n.r1&&e<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},o.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,e=0;e<n.size();e++)if(n.peek(e).vbox.contains(t))return n.peek(e).color;return this.nearest(t)},nearest:function(t){for(var n,e,r,o=this.vboxes,i=0;i<o.size();i++)((e=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)))<n||void 0===n)&&(n=e,r=o.peek(i).color);return r},forcebw:function(){var n=this.vboxes;n.sort(function(n,e){return t.naturalOrder(t.sum(n.color),t.sum(e.color))});var e=n[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(n[0].color=[0,0,0]);var r=n.length-1,o=n[r].color;o[0]>251&&o[1]>251&&o[2]>251&&(n[r].color=[255,255,255])}},{quantize:function(u,a){if(!u.length||a<2||a>256)return!1;var c=function(t){var e,r=new Array(32768);return t.forEach(function(t){e=n(t[0]>>3,t[1]>>3,t[2]>>3),r[e]=(r[e]||0)+1}),r}(u);c.forEach(function(){});var s=function(t,n){var e,o,i,u=1e6,a=0,c=1e6,s=0,h=1e6,f=0;return t.forEach(function(t){(e=t[0]>>3)<u?u=e:e>a&&(a=e),(o=t[1]>>3)<c?c=o:o>s&&(s=o),(i=t[2]>>3)<h?h=i:i>f&&(f=i)}),new r(u,a,c,s,h,f,n)}(u,c),h=new e(function(n,e){return t.naturalOrder(n.count(),e.count())});function f(t,n){for(var e,r=t.size(),o=0;o<1e3;){if(r>=n)return;if(o++>1e3)return;if((e=t.pop()).count()){var u=i(c,e),a=u[0],s=u[1];if(!a)return;t.push(a),s&&(t.push(s),r++)}else t.push(e),o++}}h.push(s),f(h,.75*a);for(var l=new e(function(n,e){return t.naturalOrder(n.count()*n.volume(),e.count()*e.volume())});h.size();)l.push(h.pop());f(l,a);for(var v=new o;l.size();)v.push(l.pop());return v}}}().quantize;const e=function(t){"CANVAS"===t.nodeName?(this.canvas=t,this.context=t.getContext("2d"),this.width=t.width,this.height=t.height):"VIDEO"===t.nodeName?(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=video.videoWidth,this.height=this.canvas.height=t.videoHeight,this.context.drawImage(t,0,0,this.width,this.height)):(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height))};e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var r=function(){};r.prototype.getColor=function(t,n=10){return this.getPalette(t,5,n)[0]},r.prototype.getPalette=function(t,r,o){const i=function(t){let{colorCount:n,quality:e}=t;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return(void 0===e||!Number.isInteger(e)||e<1)&&(e=10),{colorCount:n,quality:e}}({colorCount:r,quality:o}),u=new e(t),a=function(t,n,e){const r=t,o=[];for(let t,i,u,a,c,s=0;s<n;s+=e)t=4*s,i=r[t+0],u=r[t+1],a=r[t+2],c=r[t+3],(void 0===c||c>=125)&&(i>250&&u>250&&a>250||o.push([i,u,a]));return o}(u.getImageData().data,u.width*u.height,i.quality),c=n(a,i.colorCount);return c?c.palette():null},r.prototype.getColorFromUrl=function(t,n,e){const r=document.createElement("img");r.addEventListener("load",()=>{const o=this.getPalette(r,5,e);n(o[0],t)}),r.src=t},r.prototype.getImageData=function(t,n){let e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){if(200==this.status){let t=new Uint8Array(this.response);i=t.length;let e=new Array(i);for(let n=0;n<t.length;n++)e[n]=String.fromCharCode(t[n]);let r=e.join(""),o=window.btoa(r);n("data:image/png;base64,"+o)}},e.send()},r.prototype.getColorAsync=function(t,n,e){const r=this;this.getImageData(t,function(t){const o=document.createElement("img");o.addEventListener("load",function(){const t=r.getPalette(o,5,e);n(t[0],this)}),o.src=t})};export default r;
